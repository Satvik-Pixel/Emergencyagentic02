<!DOCTYPE html>
<html>
<head>
    <title>Doctor Dashboard</title>
</head>
<body>

<h2>Doctor Dashboard</h2>

<div id="cases"></div>

<script>
async function loadCases() {

    const response = await fetch("/doctor-requests");
    const cases = await response.json();

    const container = document.getElementById("cases");
    container.innerHTML = "";

    cases.forEach(c => {

        const div = document.createElement("div");

        div.innerHTML = `
            <strong>Case ID:</strong> ${c.case_id}<br>
            <strong>Hospital:</strong> ${c.hospital_name}<br>
            <strong>Severity:</strong> ${c.severity_level}<br>
            <strong>Status:</strong> ${c.status}<br>

            ${c.status === "Bed Reserved" ? 
                `<button onclick="acceptCase(${c.case_id})">Accept</button>` : ""}

            ${c.status === "En Route" ? 
                `<button onclick="completeCase(${c.case_id})">Complete</button>` : ""}

            <hr/>
        `;

        container.appendChild(div);
    });
}

async function acceptCase(id) {
    await fetch(`/accept-case/${id}`, { method: "POST" });
    loadCases();
}

async function completeCase(id) {
    await fetch(`/complete-case/${id}`, { method: "POST" });
    loadCases();
}

loadCases();
setInterval(loadCases, 5000); // refresh every 5 sec
</script>

</body>
</html>
